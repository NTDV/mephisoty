var Fe=Object.defineProperty;var Ie=(S,t,r)=>t in S?Fe(S,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):S[t]=r;var Z=(S,t,r)=>(Ie(S,typeof t!="symbol"?t+"":t,r),r);import{j as M,k as ke,r as c,l as Le,o as Oe,F as k,m as P,b as _,c as p,d as b,e as i,f as s,g as n,i as y,t as g,n as E,p as oe,q as se,s as L}from"./index-9144bf74.js";class Ue{async getSeason(t){return await M("/admin/season/"+t).then(r=>r.json())}async createSeason(t){return M("/admin/season",{method:"POST",body:JSON.stringify(t)}).then(r=>r.json())}getSeasons(t){return M("/admin/season/",{method:"POST",body:JSON.stringify(t)}).then(r=>r.json())}async editSeason(t,r){return await M("/admin/season/"+t,{method:"PUT",body:JSON.stringify(r)}).then(h=>h.json())}async deleteSeason(t){return await M("/admin/season/"+t,{method:"DELETE"}).then(r=>r.json())}getProductsSmall(){return fetch("/demo/data/products-small.json",{headers:{"Cache-Control":"no-cache"}}).then(t=>t.json()).then(t=>t.data)}getProducts(){return fetch("/demo/data/products.json",{headers:{"Cache-Control":"no-cache"}}).then(t=>t.json()).then(t=>t.data)}getProductsMixed(){return fetch("/demo/data/products-mixed.json",{headers:{"Cache-Control":"no-cache"}}).then(t=>t.json()).then(t=>t.data)}getProductsWithOrdersSmall(){return fetch("/demo/data/products-orders-small.json",{headers:{"Cache-Control":"no-cache"}}).then(t=>t.json()).then(t=>t.data)}getProductsWithOrdersLarge(){return fetch("/demo/data/products-orders.json",{headers:{"Cache-Control":"no-cache"}}).then(t=>t.json()).then(t=>t.data)}}class xe{constructor(){Z(this,"mapContent",{DISALLOW_ALL_FOR_PARTICIPANTS:"Скрыто",ALLOW_READ_FOR_PARTICIPANTS:"Видно",ALLOW_CREATE_READ_FOR_PARTICIPANTS:"Разрешено создание",ALLOW_CREATE_EDIT_READ_FOR_PARTICIPANTS:"Разрешено создание и изменение"});Z(this,"mapSeverity",{DISALLOW_ALL_FOR_PARTICIPANTS:"success",ALLOW_READ_FOR_PARTICIPANTS:"info",ALLOW_CREATE_READ_FOR_PARTICIPANTS:"warning",ALLOW_CREATE_EDIT_READ_FOR_PARTICIPANTS:"danger"})}getBadgeConentAll(){return Object.entries(this.mapContent).map(([t,r])=>({label:r,value:t}))}getBadgeContentViewOnly(){return Object.entries(this.mapContent).filter(([t,r])=>t==="DISALLOW_ALL_FOR_PARTICIPANTS"||t==="ALLOW_READ_FOR_PARTICIPANTS").map(([t,r])=>({label:r,value:t}))}getBadgeSeverityFor(t){return this.mapSeverity[t]}getBadgeContentFor(t){return this.mapContent[t]}}class Pe{formatDateTimeFromDate(t){const r=t.getFullYear(),h=t.getMonth()+1,K=h<10?"0"+h:h,O=t.getDate(),w=O<10?"0"+O:O,W=t.getHours(),V=t.getMinutes(),R=t.getSeconds(),N=R<10?"0"+R:R,m=W,C=m<10?"0"+m:m,a=V<10?"0"+V:V;return w+"."+K+"."+r+" "+C+":"+a+":"+N}getDateFromTimestamp(t){return new Date(t*1e3)}getDateTimeOffsetFromDate(t){return t.toISOString()}}const Ee={class:"grid"},Ne={class:"col-12"},Be={class:"card"},je={class:"my-2"},Me={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Ke=i("h5",{class:"m-0"},"Управление сезонами",-1),We={class:"field"},$e=i("label",{for:"description"},"Комментарий",-1),ze={class:"field"},Je=i("label",{for:"title"},"Название",-1),Qe={key:0,class:"p-invalid"},qe={class:"field"},He=i("label",{for:"description"},"Описание",-1),Ye={class:"field"},Ge=i("label",{for:"rules"},"Правила",-1),Xe={class:"field"},Ze=i("label",{for:"start"},"Начало",-1),et={key:0,class:"p-invalid"},tt={class:"field"},lt=i("label",{for:"end"},"Конец",-1),at={key:0,class:"p-invalid"},ot={class:"field"},st=i("label",{for:"rules"},"Формула",-1),nt={class:"field"},it=i("label",{for:"seasonVisibility"},"Видимость сезона участниками",-1),rt={key:0},dt={key:1},ut={key:0,class:"p-invalid"},ct={class:"field"},mt=i("label",{for:"scoreVisibility"},"Видимость оценок участниками",-1),vt={key:0},pt={key:1},yt={key:0,class:"p-invalid"},ht={class:"flex align-items-center justify-content-center"},ft=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),_t={key:0},bt=i("u",null,"все связанные данные",-1),gt={class:"flex align-items-center justify-content-center"},St=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Vt={key:0},wt=i("b",null,"выбранные сезоны",-1),Ct=i("u",null,"все связанные данные",-1),Dt={__name:"SeasonCrud",setup(S){const t=ke(),r=c(!1),h=c({}),K=c(0),O=c(0),w=c(!1),W=c(null),V=new Ue,R=new xe,N=new Pe,m=c(null),C=c(!1),a=c({}),T=c(null),A=c(null),B=c(!1),j=c(!1),F=c(null),I=c({}),f=c(!1),$=c(R.getBadgeContentViewOnly()),U=l=>R.getBadgeSeverityFor(l),z=l=>R.getBadgeContentFor(l),ee=N.getDateTimeOffsetFromDate,te=N.formatDateTimeFromDate,le=N.getDateFromTimestamp;Le(()=>{we()}),Oe(()=>{r.value=!0,h.value={first:0,rows:10,sortField:null,sortOrder:null,filters:I.value},J()});const J=l=>{r.value=!0,h.value={...h.value,first:(l==null?void 0:l.first)||K.value},setTimeout(()=>V.getSeasons(h.value).then(o=>{m.value=o.collection.map(u=>Y(u)),O.value=o.total,r.value=!1}),500)},ne=l=>{h.value=l,J(l)},ie=l=>{h.value=l,J(l)},re=l=>{h.value.filters=I.value,J(l)},de=l=>{w.value=l.checked,w.value?CustomerService.getCustomers().then(o=>{w.value=!0,selectedCustomers.value=o.customers}):(w.value=!1,selectedCustomers.value=[])},ue=()=>{},ce=()=>{w.value=!1},me=()=>{a.value={},f.value=!1,T.value=null,A.value=null,C.value=!0},ve=()=>{C.value=!1,f.value=!1},pe=()=>a.value&&a.value.title&&a.value.title.trim()!==""&&T.value&&A.value&&a.value.seasonVisibility&&a.value.scoreVisibility,ae=()=>({comment:a.value.comment?a.value.comment:"",title:a.value.title,description:a.value.description?a.value.description:"",rules:a.value.rules?a.value.rules:"",start:ee(T.value),end:ee(A.value),seasonResultFormula:a.value.seasonResultFormula,seasonVisibility:a.value.seasonVisibility,scoreVisibility:a.value.scoreVisibility}),Y=l=>({...l,start:le(l.start),end:le(l.end)}),ye=async()=>{if(f.value=!0,pe()){if(a.value.id)try{const l=await V.editSeason(a.value.id,ae());if(l.err){console.error(l),t.add({severity:"error",summary:"Ошибка сервера",detail:"Сезон не изменен",life:3e3});return}a.value=Y(l),m.value[fe(a.value.id)]=a.value,t.add({severity:"success",summary:"Успешно",detail:"Сезон изменен",life:3e3})}catch(l){console.error(l),t.add({severity:"error",summary:"Ошибка клиента",detail:"Сезон не изменен",life:3e3});return}else try{const l=await V.createSeason(ae());if(l.err){console.error(l),t.add({severity:"error",summary:"Ошибка сервера",detail:"Сезон не создан",life:3e3});return}a.value=Y(l),m.value.push(a.value),t.add({severity:"success",summary:"Успешно",detail:"Сезон добавлен",life:3e3})}catch(l){console.error(l),t.add({severity:"error",summary:"Ошибка клиента",detail:"Сезон не создан",life:3e3});return}C.value=!1,a.value={}}else t.add({severity:"warn",summary:"Внимание",detail:"Неверное заполнение",life:3e3})},he=l=>{a.value={...l},T.value=l.start,A.value=l.end,C.value=!0},fe=l=>{let o=-1;for(let u=0;u<m.value.length;u++)if(m.value[u].id===l){o=u;break}return o},_e=()=>{W.value.exportCSV()},be=l=>{a.value=l,B.value=!0},ge=()=>{try{const l=V.deleteSeason(a.value.id);if(l==null||l.err){console.error(l),t.add({severity:"error",summary:"Ошибка сервера",detail:"Сезон не удален",life:3e3});return}}catch(l){console.error(l),t.add({severity:"error",summary:"Ошибка клиента",detail:"Сезон не удален",life:3e3});return}m.value=m.value.filter(l=>l.id!==a.value.id),B.value=!1,a.value={},t.add({severity:"success",summary:"Успешно",detail:"Сезон удален",life:3e3})},Se=()=>{j.value=!0},Ve=()=>{try{for(const l of F.value){const o=V.deleteSeason(l.id);if(o==null||o.err){console.error(o),t.add({severity:"error",summary:"Ошибка сервера",detail:"Часть сезонов не удалена",life:3e3});return}}}catch(l){console.error(l),t.add({severity:"error",summary:"Ошибка клиента",detail:"Часть сезонов не удалена",life:3e3});return}m.value=m.value.filter(l=>!F.value.includes(l)),j.value=!1,F.value=null,t.add({severity:"success",summary:"Успешно",detail:"Сезон удален",life:3e3})},we=()=>{I.value={global:{value:null,matchMode:k.CONTAINS},id:{operator:P.AND,constraints:[{value:null,matchMode:k.EQUALS}]},title:{operator:P.AND,constraints:[{value:null,matchMode:k.STARTS_WITH}]},start:{operator:P.AND,constraints:[{value:null,matchMode:k.DATE_IS}]},end:{operator:P.AND,constraints:[{value:null,matchMode:k.DATE_IS}]},seasonVisibility:{operator:P.OR,constraints:[{value:null,matchMode:k.EQUALS}]},scoreVisibility:{operator:P.OR,constraints:[{value:null,matchMode:k.EQUALS}]}}};return(l,o)=>{const u=_("Button"),Ce=_("Toolbar"),Te=_("InputIcon"),G=_("InputText"),Ae=_("IconField"),D=_("Column"),De=_("InputNumber"),Q=_("Calendar"),x=_("Tag"),q=_("Dropdown"),Re=_("DataTable"),H=_("Textarea"),X=_("Dialog");return p(),b("div",Ee,[i("div",Ne,[i("div",Be,[s(Ce,{class:"mb-4"},{start:n(()=>[i("div",je,[s(u,{label:"Добавить",icon:"pi pi-plus",class:"mr-2",severity:"success",onClick:me}),s(u,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:Se,disabled:!F.value||!F.value.length},null,8,["disabled"])])]),end:n(()=>[s(u,{label:"Экспорт",icon:"pi pi-upload",severity:"help",onClick:o[0]||(o[0]=e=>_e(e))})]),_:1}),s(Re,{ref_key:"dt",ref:W,lazy:"",value:m.value,selection:F.value,"onUpdate:selection":o[2]||(o[2]=e=>F.value=e),selectAll:w.value,onSelectAllChange:de,onRowSelect:ue,onRowUnselect:ce,dataKey:"id",paginator:!0,rows:10,filters:I.value,"onUpdate:filters":o[3]||(o[3]=e=>I.value=e),first:K.value,totalRecords:O.value,loading:r.value,onPage:o[4]||(o[4]=e=>ne(e)),onSort:o[5]||(o[5]=e=>ie(e)),onFilter:o[6]||(o[6]=e=>re(e)),"filter-display":"menu","global-filter-fields":["id","title"],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,50,100,500,1e3],currentPageReportTemplate:"Сезоны с {first} по {last} из {totalRecords} загруженных",sortMode:"multiple"},{header:n(()=>[i("div",Me,[Ke,s(Ae,{iconPosition:"left",class:"block mt-2 md:mt-0"},{default:n(()=>[s(Te,{class:"pi pi-search"}),s(G,{class:"w-full sm:w-auto",modelValue:I.value.global.value,"onUpdate:modelValue":o[1]||(o[1]=e=>I.value.global.value=e),placeholder:"Быстрый поиск..."},null,8,["modelValue"])]),_:1})])]),empty:n(()=>[y(" Сезонов не найдено. ")]),loading:n(()=>[y(" Загрузка. Пожалуйста, подождите. ")]),default:n(()=>[s(D,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(D,{field:"id",header:"ID",sortable:!0,dataType:"numeric",headerStyle:"width:10%; min-width:5rem;"},{body:n(e=>[y(g(e.data.id),1)]),filter:n(({filterModel:e,filterCallback:v})=>[s(De,{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,onKeydown:E(d=>v(),["enter"]),mode:"decimal"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),s(D,{field:"title",header:"Название",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:n(e=>[y(g(e.data.title),1)]),filter:n(({filterModel:e,filterCallback:v})=>[s(G,{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,onKeydown:E(d=>v(),["enter"]),type:"text",class:"p-column-filter",placeholder:"Искать по названию"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),s(D,{field:"start",dataType:"date",header:"Начало",sortable:!0,headerStyle:"width:16%; min-width:10rem;"},{body:n(e=>[y(g(oe(te)(e.data.start)),1)]),filter:n(({filterModel:e,filterCallback:v})=>[s(Q,{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,selectionMode:"single","date-format":"dd.mm.yy",showTime:!0,"hour-format":"24",showSeconds:!0,showIcon:!0,showButtonBar:!0,placeholder:"dd.mm.yyyy hh:mm:ss",mask:"99.99.9999 99:99:99",onKeydown:E(d=>v(),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),s(D,{field:"end",dataType:"date",header:"Конец",sortable:!0,headerStyle:"width:16%; min-width:10rem;"},{body:n(e=>[y(g(oe(te)(e.data.end)),1)]),filter:n(({filterModel:e,filterCallback:v})=>[s(Q,{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,selectionMode:"single","date-format":"dd.mm.yy",showTime:!0,"hour-format":"24",showSeconds:!0,showIcon:!0,showButtonBar:!0,placeholder:"dd.mm.yyyy hh:mm:ss",mask:"99.99.9999 99:99:99",onKeydown:E(d=>v(),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),s(D,{field:"seasonVisibility",header:"Видимость сезона участниками",sortable:!0,showFilterMatchModes:!1,headerStyle:"width:16%; min-width:13rem;"},{body:n(e=>[s(x,{severity:U(e.data.seasonVisibility)},{default:n(()=>[y(g(z(e.data.seasonVisibility)),1)]),_:2},1032,["severity"])]),filter:n(({filterModel:e,filterCallback:v})=>[s(q,{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,options:$.value,optionLabel:"label","option-value":"value",placeholder:"Выберите один",class:"p-column-filter",showClear:"",onKeydown:E(d=>v(),["enter"])},{option:n(d=>[(p(),se(x,{key:d.option.value,value:d.option.label,severity:U(d.option.value)},null,8,["value","severity"]))]),_:2},1032,["modelValue","onUpdate:modelValue","options","onKeydown"])]),_:1}),s(D,{field:"scoreVisibility",header:"Видимость оценок участниками",sortable:!0,showFilterMatchModes:!1,headerStyle:"width:16%; min-width:13rem;"},{body:n(e=>[s(x,{severity:U(e.data.scoreVisibility)},{default:n(()=>[y(g(z(e.data.scoreVisibility)),1)]),_:2},1032,["severity"])]),filter:n(({filterModel:e,filterCallback:v})=>[s(q,{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,options:$.value,optionLabel:"label","option-value":"value",placeholder:"Выберите один",class:"p-column-filter",showClear:"",onKeydown:E(d=>v(),["enter"])},{option:n(d=>[(p(),se(x,{key:d.option.value,value:d.option.label,severity:U(d.option.value)},null,8,["value","severity"]))]),_:2},1032,["modelValue","onUpdate:modelValue","options","onKeydown"])]),_:1}),s(D,{header:"Действия",headerStyle:"width:10%;min-width:11rem;"},{body:n(e=>[s(u,{icon:"pi pi-eye",class:"mr-2",severity:"success",rounded:"",onClick:v=>l.viewSeason(e.data.id)},null,8,["onClick"]),s(u,{icon:"pi pi-pencil",class:"mr-2",severity:"warning",rounded:"",onClick:v=>he(e.data)},null,8,["onClick"]),s(u,{icon:"pi pi-trash",class:"mr-2",severity:"danger",rounded:"",onClick:v=>be(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","selectAll","filters","first","totalRecords","loading"]),s(X,{visible:C.value,"onUpdate:visible":o[16]||(o[16]=e=>C.value=e),style:{width:"700px"},header:"Информация о сезоне",modal:!0,class:"p-fluid"},{footer:n(()=>[s(u,{label:"Отменить",icon:"pi pi-times",text:"",onClick:ve}),s(u,{label:"Сохранить",icon:"pi pi-check",onClick:ye})]),default:n(()=>[i("div",We,[$e,s(H,{id:"description",modelValue:a.value.comment,"onUpdate:modelValue":o[7]||(o[7]=e=>a.value.comment=e),autoResize:"",rows:"1",maxlength:"200"},null,8,["modelValue"])]),i("div",ze,[Je,s(G,{id:"title",modelValue:a.value.title,"onUpdate:modelValue":o[8]||(o[8]=e=>a.value.title=e),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:f.value&&!a.value.title,maxlength:"120"},null,8,["modelValue","invalid"]),f.value&&(!a.value.title||a.value.title.trim()==="")?(p(),b("small",Qe,"Введите название.")):L("",!0)]),i("div",qe,[He,s(H,{id:"description",modelValue:a.value.description,"onUpdate:modelValue":o[9]||(o[9]=e=>a.value.description=e),rows:"3",cols:"30",maxlength:"2000"},null,8,["modelValue"])]),i("div",Ye,[Ge,s(H,{id:"rules",modelValue:a.value.rules,"onUpdate:modelValue":o[10]||(o[10]=e=>a.value.rules=e),rows:"3",maxlength:"2000"},null,8,["modelValue"])]),i("div",Xe,[Ze,s(Q,{selectionMode:"single","date-format":"dd.mm.yy",invalid:f.value&&!T.value,showTime:!0,"hour-format":"24",showSeconds:!0,showIcon:!0,showButtonBar:!0,modelValue:T.value,"onUpdate:modelValue":o[11]||(o[11]=e=>T.value=e),mask:"99.99.9999 99:99:99"},null,8,["invalid","modelValue"]),f.value&&!T.value?(p(),b("small",et,"Введите дату и время начала сезона.")):L("",!0)]),i("div",tt,[lt,s(Q,{selectionMode:"single","date-format":"dd.mm.yy",invalid:f.value&&!A.value,showTime:!0,showSeconds:!0,showIcon:!0,showButtonBar:!0,modelValue:A.value,"onUpdate:modelValue":o[12]||(o[12]=e=>A.value=e),mask:"99.99.9999 99:99:99"},null,8,["invalid","modelValue"]),f.value&&!A.value?(p(),b("small",at,"Введите дату и время конца сезона.")):L("",!0)]),i("div",ot,[st,s(H,{id:"rules",disabled:"",modelValue:a.value.seasonResultFormula,"onUpdate:modelValue":o[13]||(o[13]=e=>a.value.seasonResultFormula=e),rows:"3",cols:"20"},null,8,["modelValue"])]),i("div",nt,[it,s(q,{id:"seasonVisibility",modelValue:a.value.seasonVisibility,"onUpdate:modelValue":o[14]||(o[14]=e=>a.value.seasonVisibility=e),options:$.value,optionLabel:"label","option-value":"value",invalid:f.value&&!a.value.seasonVisibility,placeholder:"Выберите ограничение"},{value:n(e=>[e.value?(p(),b("span",rt,g(z(e.value)),1)):(p(),b("span",dt,g(e.placeholder),1))]),option:n(e=>[s(x,{value:e.option.label,severity:U(e.option.value)},null,8,["value","severity"])]),_:1},8,["modelValue","options","invalid"]),f.value&&!a.value.seasonVisibility?(p(),b("small",ut,"Выберите один из вариантов.")):L("",!0)]),i("div",ct,[mt,s(q,{id:"scoreVisibility",modelValue:a.value.scoreVisibility,"onUpdate:modelValue":o[15]||(o[15]=e=>a.value.scoreVisibility=e),options:$.value,optionLabel:"label","option-value":"value",invalid:f.value&&!a.value.scoreVisibility,placeholder:"Выберите ограничение"},{value:n(e=>[e.value?(p(),b("span",vt,g(z(e.value)),1)):(p(),b("span",pt,g(e.placeholder),1))]),option:n(e=>[s(x,{value:e.option.label,severity:U(e.option.value)},null,8,["value","severity"])]),_:1},8,["modelValue","options","invalid"]),f.value&&!a.value.seasonVisibility?(p(),b("small",yt,"Выберите один из вариантов.")):L("",!0)])]),_:1},8,["visible"]),s(X,{visible:B.value,"onUpdate:visible":o[18]||(o[18]=e=>B.value=e),style:{width:"700px"},header:"Подтверждение",modal:!0},{footer:n(()=>[s(u,{label:"Нет",icon:"pi pi-times",onClick:o[17]||(o[17]=e=>B.value=!1)}),s(u,{label:"Да",icon:"pi pi-trash",severity:"danger",text:"",onClick:ge})]),default:n(()=>[i("div",ht,[ft,a.value?(p(),b("span",_t,[y("Вы точно хотите удалить сезон "),i("b",null,g(a.value.title),1),y(" и "),bt,y("?")])):L("",!0)])]),_:1},8,["visible"]),s(X,{visible:j.value,"onUpdate:visible":o[20]||(o[20]=e=>j.value=e),style:{width:"700px"},header:"Подтверждение",modal:!0},{footer:n(()=>[s(u,{label:"Нет",icon:"pi pi-times",onClick:o[19]||(o[19]=e=>j.value=!1)}),s(u,{label:"Да",icon:"pi pi-trash",severity:"danger",text:"",onClick:Ve})]),default:n(()=>[i("div",gt,[St,m.value?(p(),b("span",Vt,[y("Вы точно хотите удалить "),wt,y(" и "),Ct,y("?")])):L("",!0)])]),_:1},8,["visible"])])])])}}};export{Dt as default};
